<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
xmlns:ui="http://java.sun.com/jsf/facelets" 
xmlns:f="http://java.sun.com/jsf/core"
xmlns:h="http://java.sun.com/jsf/html"
xmlns:p="http://primefaces.org/ui"
lang="en">
<h:body>
<f:view>
		<ui:composition template="${pageContext.request.contextPath}/templates/privatemaintemplate.xhtml">
			<ui:define name="title">Users</ui:define>	
			<ui:define name="scripts">
				<script type="text/javascript">
				    function test(){
				        var i = $('.ui-row-toggler.ui-icon-circle-triangle-s').length;
				        if(i == 1){return;}
				            $('.ui-row-toggler.ui-icon-circle-triangle-s').trigger('click');
				    }
				</script>
			</ui:define>
			<ui:define name="crums">User Management ></ui:define>
			<ui:define name="pageheader">User Management</ui:define>
			<ui:define name="topcontent">
				<h:form id="indexMainForm">
		        <p:panel id="indexMainPanel" class="ui-g-12 ui-md-12 ui-lg-12" style="min-height:500px;">
					 <div class="ui-g-12 ui-md-12 ui-lg-12">
	                	<h2>User Management</h2>
	                	<p>Form this page you can add, edit and delete user profiles. Select a user from the table to edit its properties.</p>
	                	<p:messages showDetail="true" autoUpdate="true" closable="true" />
	                	<p:panel id="mainConentPanel" class="ui-g-12 ui-md-12 ui-lg-12"
	                				style="border:none;">
	                		<p:dataTable id="userTable"
	                					 widgetVar="userTableWidget"
	                					 value="#{userManagementBean.allUsersList}"
	                					 var="user"
	                					 reflow="true"
	                					 paginator="true"
	                					 rowKey="#{user.id}" expandedRow="#{user.id == userManagementBean.selectedUser.id}">
	                					 <p:ajax event="rowToggle" onstart="test();"/>  
								<p:column style="width:16px">
									<p:rowToggler />
								</p:column>
								<p:column headerText="First Name">
									<p:outputLabel value="#{user.firstName}"/>		                			
	                			</p:column>
	                			<p:column headerText="Last Name">
									<p:outputLabel value="#{user.lastName}"/>		                			
	                			</p:column>
	                			<p:column headerText="Email">
									<p:outputLabel value="#{user.email}"/>		                			
	                			</p:column>
	                			<p:column headerText="Role">
									<p:outputLabel value="#{user.role}"/>		                			
	                			</p:column>
	                			<p:column headerText="Locked"
	                					 style="width:60px;">
									<p:outputLabel value="#{user.locked}"/>		                			
	                			</p:column>
	                			<p:column headerText="Locked On">
									<p:outputLabel value="#{user.lockedOn}"/>		                			
	                			</p:column>
	                			<p:rowExpansion>
	                				<p:panel id = "editPanelExpansion" class="ui-g-12 ui-md-12 ui-lg-12" style="border:none; background-color: #F5F5F5;">
	                					<p style="font-weight:bold;">Edit User</p>
	                					<div class="ui-g-12 ui-md-12 ui-lg-5">
	                						<p:panelGrid styleClass="ui-panelgrid-blank"
	                									 layout="grid" columns = "2">
	                							<p:column>
	                								<p:outputLabel value="First Name: "/>
	                							</p:column>
	                							<p:column>
	                								<p:inputText value="#{user.firstName}"/>
	                							</p:column>
	                							<p:column>
	                								<p:outputLabel value="Last Name: "/>
	                							</p:column>
	                							<p:column>
	                								<p:inputText value="#{user.lastName}"/>
	                							</p:column>
	                							<p:column>
	                								<p:outputLabel value="Email: "/>
	                							</p:column>
	                							<p:column>
	                								<p:inputText value="#{user.email}"/>
	                							</p:column>
	                								<p:column>
													<p:commandButton value="Save" action="#{userManagementBean.updateUser}"
																	 style="width:100px"
																	 update="userTable">
														<f:setPropertyActionListener value="#{user}" 
																						 target="#{userManagementBean.selectedUser}"/>
													</p:commandButton>
												</p:column>
												<p:column>
													<p:commandButton value="Unlock"	
																	  style="width:100px;"
																	  disabled="#{user.locked == 0}"
																	  action="#{userManagementBean.resetUser}"
																	  update="userTable"
																	  oncomplete="PF(userTableWidget).clearFilters()">
															<f:setPropertyActionListener value="#{user}" 
																						 target="#{userManagementBean.selectedUser}"/>
													</p:commandButton>
												</p:column>
	                						</p:panelGrid>
	                					</div>
	                					<div class="ui-g-12 ui-md-12 ui-lg-5">
	                						<p:panelGrid styleClass="ui-panelgrid-blank"
	                									 layout="grid" columns = "2">
												<p:column>
													<p:outputLabel value="Role: " />
												</p:column>
												<p:column>
													<p:selectOneMenu value="#{user.role}">
														<f:selectItems value="#{userManagementBean.userRoleMap}"/>
													</p:selectOneMenu>
												</p:column>
												<p:column>
													<p:outputLabel value="Locked: " />
												</p:column>
												<p:column>
													<p:outputLabel value="#{user.locked}" />
												</p:column>
												<p:column>
													<p:outputLabel value="Locked On: " />
												</p:column>
												<p:column>
													<p:outputLabel value="#{user.lockedOn}" />
												</p:column>
											</p:panelGrid>
	                					</div>
	                				</p:panel>
	                			</p:rowExpansion>
	                		</p:dataTable>
	                	</p:panel>
                	</div>	
				</p:panel>
				</h:form>
			</ui:define>
			<ui:define name="middlecontent">
				
			</ui:define>
		</ui:composition>	
</f:view>
</h:body>
</html>
